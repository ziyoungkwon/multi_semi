<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<th:block th:fragment="fragment">

    <style>
        /* 이미지 갤러리 컨테이너 */
        #my-image-container {
            display: flex;
            flex-wrap: wrap; /* 이미지가 넘치면 다음 줄로 */
            gap: 15px; /* 이미지 사이의 간격 */
        }

        /* 개별 이미지 스타일 */
        #my-image-container img {
            width: 250px;
            height: 250px;
            object-fit: cover; /* 비율을 유지하며 꽉 채우기 */
            border: 1px solid #ddd;
            border-radius: 8px; /* 모서리 둥글게 */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        #my-image-container img:hover {
            transform: scale(1.03); /* 마우스 오버 시 살짝 확대 */
        }

        /* 메시지 스타일 */
        .status-message {
            font-size: 1.1em;
            color: #555;
        }
        .error-message {
            color: red;
        }
    </style>

    <h1>내가 생성한 이미지</h1>

    <div id="my-image-container">
        <p id="loading-message" class="status-message">이미지를 불러오는 중입니다...</p>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const container = document.getElementById("my-image-container");
            const loadingMessage = document.getElementById("loading-message");

            fetch("/api/v1/ai-images/my")
                .then(response => {
                    if (!response.ok) {
                        throw new Error("응답 실패: " + response.status);
                    }
                    return response.json();
                })
                .then(responseDto => { // [수정] imageList가 아니라 responseDto를 받을 수 있습니다.

                    // 서버 응답 구조에 따라 imageList를 추출합니다.
                    // 1. { data: [...] } 구조일 경우
                    const imageList = responseDto.data;
                    // 2. [...] (배열) 구조일 경우
                    // const imageList = responseDto;

                    // 디버깅 코드는 유지
                    console.log("서버로부터 받은 데이터:", responseDto);
                    // debugger;

                    if(loadingMessage) loadingMessage.style.display = "none";

                    if (!imageList || imageList.length === 0) {
                        container.innerHTML = '<p class="status-message">아직 생성한 이미지가 없습니다.</p>';
                        return;
                    }

                    imageList.forEach(imageDto => {
                        console.log("이미지 DTO 확인:", imageDto);
                        const imgElement = document.createElement("img");

                        // orgUrl이 없을 경우 대비 (필요시 수정)
                        const imageUrl = imageDto.orgUrl || imageDto.imgUrl || 'fallback-image.png';
                        console.log("img.src에 할당할 값:", imageUrl);

                        imgElement.src = imageUrl;
                        imgElement.alt = "AI 생성 이미지";
                        container.appendChild(imgElement);
                    });
                })
                .catch(error => {
                    console.error("Fetch 또는 .then 블록 에러:", error);

                    if (loadingMessage) {
                        loadingMessage.style.display = "none";
                    }
                    container.innerHTML = `<p class="status-message error-message">오류 발생: ${error.message}</p>`;
                });
        });
    </script>

</th:block>
</html>