<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<th:block th:fragment="fragment">

    <h2>ë‚´ ë¦¬ë·°</h2>
    <div class="mypage-content-header">
        <div class="mypage-content-sub" id="review-count-text">
            ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦
        </div>
    </div>

    <div id="review-list" class="review-list"></div>

    <div id="empty-message" class="empty-message" style="display: none;">
        ì•„ì§ ì‘ì„±í•œ ë¦¬ë·°ê°€ ì—†ì–´ìš”.<br>
        ì—¬í–‰ ëŒ€ë¦¬ë§Œì¡± ì‚¬ì§„ì„ ë§Œë“¤ê³  ì²« ë¦¬ë·°ë¥¼ ë‚¨ê²¨ë³¼ê¹Œìš”? ğŸ˜Š
    </div>

    <style>
        /* â­ ë¦¬ë·° ì¹´ë“œ ì „ì²´ë¥¼ ê°€ë¡œ ì •ë ¬ë¡œ í™•ì¥ */
        .review-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* â­ í…ìŠ¤íŠ¸ ì˜ì—­ë„ í™•ì¥ */
        .review-info {
            flex: 1;
        }

        /* â­ ë²„íŠ¼ì„ ì˜¤ë¥¸ìª½ ì •ë ¬ */
        .detail-right {
            display: flex;
            align-items: center;
            justify-content: center;
            padding-right: 20px;
        }

        /* â­ ì¹´ì¹´ì˜¤ ë…¸ë€ìƒ‰ ë²„íŠ¼ */
        .review-detail-btn {
            padding: 7px 14px;
            background-color: #FEE500; /* ì¹´ì¹´ì˜¤ ë…¸ë‘ */
            color: #3c1e1e !important;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none !important;
            border: 1px solid #e5c100;
            transition: 0.15s ease-in-out;
        }

        .review-detail-btn:hover {
            background-color: #FFD800;
        }
    </style>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            loadMyReviews();
        });

        function loadMyReviews() {

            fetch("/api/v1/reviews/my", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                }
            })
                .then(res => {
                    if (!res.ok) {
                        throw new Error("ë¦¬ë·° ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨");
                    }
                    return res.json();
                })
                .then(data => {
                    const reviews = Array.isArray(data) ? data : data.data;
                    renderReviewList(reviews);
                })
                .catch(err => {
                    console.error(err);
                    const countText = document.getElementById("review-count-text");
                    if (countText) countText.textContent = "ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
                });
        }

        function renderReviewList(reviews) {
            const listEl = document.getElementById("review-list");
            const emptyEl = document.getElementById("empty-message");
            const countText = document.getElementById("review-count-text");

            if (!listEl || !emptyEl || !countText) return;

            listEl.innerHTML = "";

            if (!reviews || reviews.length === 0) {
                emptyEl.style.display = "block";
                countText.textContent = "ì‘ì„±í•œ ë¦¬ë·° 0ê°œ";
                return;
            }

            emptyEl.style.display = "none";
            countText.textContent = `ì‘ì„±í•œ ë¦¬ë·° ${reviews.length}ê°œ`;

            reviews.forEach(review => {
                const card = document.createElement("div");
                card.className = "review-card";

                const thumb = document.createElement("div");
                thumb.className = "review-thumbnail";

                if (review.imgUrl) {
                    const img = document.createElement("img");
                    img.src = review.imgUrl;
                    img.alt = review.title || "ë¦¬ë·° ì´ë¯¸ì§€";
                    thumb.appendChild(img);
                }

                const info = document.createElement("div");
                info.className = "review-info";

                const place = document.createElement("div");
                place.className = "review-place";
                place.textContent = review.placeTitle || "ì—¬í–‰ì§€ ì •ë³´ ì—†ìŒ";

                const title = document.createElement("div");
                title.className = "review-title";
                title.textContent = review.title;

                const content = document.createElement("div");
                content.className = "review-content";
                content.textContent = review.content;

                const meta = document.createElement("div");
                meta.className = "review-meta";

                const rateBadge = document.createElement("span");
                rateBadge.className = "badge-rate";
                rateBadge.textContent = `â˜… ${review.rate || 0} / 5`;

                const created = document.createElement("span");
                let createDate = review.createdAt || "";
                if (createDate.includes("T")) {
                    createDate = createDate.split("T")[0];
                }
                created.textContent = createDate;

                meta.appendChild(rateBadge);
                meta.appendChild(created);

                info.appendChild(place);
                info.appendChild(title);
                info.appendChild(content);
                info.appendChild(meta);

                /* â­â­â­ ì˜¤ë¥¸ìª½ ë²„íŠ¼ ë°•ìŠ¤ â­â­â­ */
                const rightBox = document.createElement("div");
                rightBox.className = "detail-right";

                const detailBtn = document.createElement("a");
                detailBtn.href = `/reviews/${review.no}`;
                detailBtn.textContent = "ìƒì„¸ë³´ê¸°";
                detailBtn.className = "review-detail-btn";

                rightBox.appendChild(detailBtn);

                /* ì¹´ë“œì— êµ¬ì„± ìš”ì†Œ ì‚½ì… */
                card.appendChild(thumb);
                card.appendChild(info);
                card.appendChild(rightBox);

                listEl.appendChild(card);
            });
        }
    </script>

</th:block>
</html>
