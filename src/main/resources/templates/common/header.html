<div th:fragment="header">

    <!-- í† í° í…ŒìŠ¤íŠ¸ìš© -->
    <a href="#" id="test-refresh-accessToken">ìš”ì²­ ì‹¤íŒ¨ ì‹œ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”!</a>

    <script>
        document.getElementById('test-refresh-accessToken').addEventListener('click', async (e) => {
            e.preventDefault();
            const response = await fetch('/refresh/test', {method: 'GET'});
            const result = await response.json();
            console.log('ì‘ë‹µ ê²°ê³¼:', result);
        });
    </script>

    <!-- í—¤ë” ìƒë‹¨ -->
    <div class="vt-header-top">

        <a th:href="@{/}" class="logo">
            <h1>Virtual Trip</h1>
        </a>

        <!-- ê²€ìƒ‰ì°½ -->
        <div class="search-wrapper">
            <button class="category-btn" disabled style="cursor: default;">ê´€ê´‘ì§€ëª…</button>
            <input type="text" class="search-input" placeholder="ì—¬í–‰ì§€ë¥¼ ê²€ìƒ‰í•´ ë³´ì„¸ìš”">
            <button class="search-icon-btn" aria-label="ê²€ìƒ‰">ğŸ”</button>
        </div>

        <!-- ë¡œê·¸ì¸ ì˜ì—­ -->
        <div class="header-auth-area">
            <span id="user-email-display" style="display: none;"></span>
            <a th:href="@{/auth/login}" id="global-login-link">ë¡œê·¸ì¸</a>
            <button type="button" id="logout-btn" style="cursor: pointer;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="vt-nav">
        <a th:href="@{/}" class="nav-item">í™ˆ</a>
        <a th:href="@{/places/list}" class="nav-item">ê´€ê´‘ì§€ ëª©ë¡</a>
        <a th:href="@{/reviews/list}" class="nav-item">ë¦¬ë·° ê²Œì‹œíŒ</a>
        <a th:href="@{/api/v1/generate-request}" class="nav-item">ì´ë¯¸ì§€ ë§Œë“¤ê¸°</a>
        <a th:href="@{/api/v1/mypage}" class="nav-item">ë§ˆì´í˜ì´ì§€</a>
        <a th:href="@{/api/v1/admin/page}" class="nav-item" id="admin-page-link" style="display: none;">ê´€ë¦¬ì í˜ì´ì§€</a>
    </nav>

    <!-- ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™ -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchBtn = document.querySelector('.search-icon-btn');
            const searchInput = document.querySelector('.search-input');

            if (!searchBtn || !searchInput) {
                console.error("ê²€ìƒ‰ ë²„íŠ¼ ë˜ëŠ” ì…ë ¥ì°½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            searchBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const query = searchInput.value.trim();

                if (!query) {
                    alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                    return;
                }

                // í˜ì´ì§€ ì´ë™
                const encoded = encodeURIComponent(query);
                window.location.href = `/places/search-result?keyword=${encoded}`;
            });
        });
    </script>
    <!-- ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ & ì—”í„° ì‹œ ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€ ì´ë™ -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchBtn = document.querySelector('.search-icon-btn');
            const searchInput = document.querySelector('.search-input');

            if (!searchBtn || !searchInput) {
                console.error("ê²€ìƒ‰ ë²„íŠ¼ ë˜ëŠ” ì…ë ¥ì°½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // ğŸ” ê²€ìƒ‰ ì‹¤í–‰ í•¨ìˆ˜
            const executeSearch = () => {
                const query = searchInput.value.trim();

                if (!query) {
                    alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                    return;
                }

                const encoded = encodeURIComponent(query);
                window.location.href = `/places/search-result?keyword=${encoded}`;
            };

            // ğŸ” ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ
            searchBtn.addEventListener('click', (e) => {
                e.preventDefault();
                executeSearch();
            });

            // âŒ¨ï¸ ì—”í„° í‚¤ ì…ë ¥ ì‹œ
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    executeSearch();
                }
            });
        });
    </script>

    <!-- (ì´í•˜ ê³µí†µ: í† í°, ì¸ì¦, UI ì œì–´ ë“± ìƒëµ ì—†ì´ ìœ ì§€) -->
    <!-- ... ì¤‘ëµ: ìœ„ì— ì£¼ì…¨ë˜ í† í° ê´€ë¦¬, ë¡œê·¸ì¸ ìƒíƒœ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ë“¤ ê·¸ëŒ€ë¡œ ì‚¬ìš© ... -->

</div>

<!--<div th:fragment="header">-->

<!--    <a href="#" id="test-refresh-accessToken">ìš”ì²­ ì‹¤íŒ¨ ì‹œ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”!</a>-->

<!--    <script>-->
<!--        document.getElementById('test-refresh-accessToken').addEventListener('click', async (e) => {-->
<!--            e.preventDefault();-->

<!--            const response = await fetch('/refresh/test', {method: 'GET'});-->

<!--            const result = await response.json();-->
<!--            console.log('ì‘ë‹µ ê²°ê³¼:', result);-->
<!--        });-->
<!--    </script>-->


<!--    <div class="vt-header-top">-->

<!--        <a th:href="@{/}" class="logo">-->
<!--            <h1>Virtual Trip</h1>-->
<!--        </a>-->

<!--        <div class="search-wrapper">-->
<!--            <button class="category-btn" disabled style="cursor: default;">ê´€ê´‘ì§€ëª…</button>-->
<!--            <input type="text" class="search-input" placeholder="ì—¬í–‰ì§€ë¥¼ ê²€ìƒ‰í•´ ë³´ì„¸ìš”">-->
<!--            <button class="search-icon-btn" aria-label="ê²€ìƒ‰" onclick="location.href='/places/search'">ğŸ”</button>-->

<!--            &lt;!&ndash;            <button class="search-icon-btn" aria-label="ê²€ìƒ‰">ğŸ”</button>&ndash;&gt;-->
<!--        </div>-->

<!--        <div class="header-auth-area">-->
<!--            <span id="user-email-display" style="display: none;"></span>-->
<!--            <a th:href="@{/auth/login}" id="global-login-link">ë¡œê·¸ì¸</a>-->
<!--            <button type="button" id="logout-btn" style="cursor: pointer;">ë¡œê·¸ì•„ì›ƒ</button>-->
<!--        </div>-->
<!--    </div>-->

<!--    <nav class="vt-nav">-->
<!--        <a th:href="@{/}" class="nav-item">í™ˆ</a>-->
<!--        <a th:href="@{/places/list}" class="nav-item">ê´€ê´‘ì§€ ëª©ë¡</a>-->
<!--        <a th:href="@{/reviews/list}" class="nav-item">ë¦¬ë·° ê²Œì‹œíŒ</a>-->
<!--        <a th:href="@{/api/v1/generate-request}" class="nav-item">ì´ë¯¸ì§€ ë§Œë“¤ê¸°</a>-->
<!--        <a th:href="@{/api/v1/mypage}" class="nav-item">ë§ˆì´í˜ì´ì§€</a>-->
<!--        <a th:href="@{/api/v1/admin/page}" class="nav-item" id="admin-page-link" style="display: none;">ê´€ë¦¬ì í˜ì´ì§€</a>-->
<!--    </nav>-->


<!--    <script>-->
<!--        document.addEventListener('DOMContentLoaded', () => {-->
<!--            const categoryBtn = document.querySelector('.category-btn');-->
<!--            const categoryDropdown = document.getElementById('category-dropdown');-->
<!--            const categoryItems = document.querySelectorAll('.category-item');-->
<!--            const searchInput = document.querySelector('.search-input');-->
<!--            const searchBtn = document.querySelector('.search-icon-btn');-->

<!--            if (!categoryBtn || !categoryDropdown || !categoryItems.length || !searchInput || !searchBtn) {-->
<!--                console.error("ê²€ìƒ‰ UI ìš”ì†Œë¥¼ ëª¨ë‘ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");-->
<!--                return;-->
<!--            }-->

<!--            // -&#45;&#45; 1. ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ í´ë¦­: ë“œë¡­ë‹¤ìš´ í† ê¸€ -&#45;&#45;-->
<!--            categoryBtn.addEventListener('click', (e) => {-->
<!--                e.preventDefault();-->
<!--                const isHidden = categoryDropdown.style.display === 'none';-->
<!--                categoryDropdown.style.display = isHidden ? 'block' : 'none';-->
<!--            });-->

<!--            // -&#45;&#45; 2. ë“œë¡­ë‹¤ìš´ í•­ëª© í´ë¦­: ì¹´í…Œê³ ë¦¬ ì„ íƒ -&#45;&#45;-->
<!--            categoryItems.forEach(item => {-->
<!--                item.addEventListener('click', (e) => {-->
<!--                    const selectedValue = e.currentTarget.getAttribute('data-value');-->
<!--                    categoryBtn.textContent = selectedValue;-->
<!--                    categoryDropdown.style.display = 'none';-->
<!--                });-->
<!--            });-->

<!--            // -&#45;&#45; 3. ê²€ìƒ‰ ë²„íŠ¼(ë‹ë³´ê¸°) í´ë¦­: API ìš”ì²­ -&#45;&#45;-->
<!--            searchBtn.addEventListener('click', async (e) => {-->
<!--                e.preventDefault();-->

<!--                const category = categoryBtn.textContent.trim();-->
<!--                const query = searchInput.value;-->
<!--                const encodedQuery = encodeURIComponent(query);-->

<!--                let targetUrl = '';-->

<!--                switch (category) {-->
<!--                    case 'ì „ì²´':-->
<!--                        targetUrl = '/api/v1/places';-->
<!--                        break;-->
<!--                    case 'ê´€ê´‘ì§€ëª…':-->
<!--                        targetUrl = `/api/v1/places/search?title=${encodedQuery}`;-->
<!--                        break;-->
<!--                    case 'ì§€ì—­ëª…':-->
<!--                        targetUrl = `/api/v1/places/district?dist=${encodedQuery}`;-->
<!--                        break;-->
<!--                    case 'í‰ì ë³„':-->
<!--                        targetUrl = `/api/v1/places/rate?rating=${encodedQuery}`;-->
<!--                        break;-->
<!--                    default:-->
<!--                        console.error('ì•Œ ìˆ˜ ì—†ëŠ” ì¹´í…Œê³ ë¦¬:', category);-->
<!--                        return;-->
<!--                }-->

<!--                console.log(`[ê²€ìƒ‰ ìš”ì²­]-->
<!--                - ì¹´í…Œê³ ë¦¬: ${category}-->
<!--                - ê²€ìƒ‰ì–´: ${query}-->
<!--                - ìš”ì²­ URL: ${targetUrl}`);-->

<!--                try {-->
<!--                    const response = await fetch(targetUrl, {-->
<!--                        method: 'GET'-->
<!--                    });-->

<!--                    if (response.ok) {-->
<!--                        const result = await response.json();-->
<!--                        console.log('ê²€ìƒ‰ ì„±ê³µ:', result.data);-->
<!--                        alert('ê²€ìƒ‰ ìš”ì²­ ì„±ê³µ! (ì½˜ì†” ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”)');-->
<!--                    } else {-->
<!--                        const errorResult = await response.json();-->
<!--                        console.error('ê²€ìƒ‰ ì‹¤íŒ¨:', errorResult.message);-->
<!--                        alert(`ê²€ìƒ‰ ì‹¤íŒ¨: ${errorResult.message}`);-->
<!--                    }-->

<!--                } catch (error) {-->
<!--                    if (error.name === "TokenRefreshedError") {-->
<!--                        console.error("í† í° ê°±ì‹  í›„ ì¬ì‹œë„í–ˆìœ¼ë‚˜ ìµœì¢… ì‹¤íŒ¨:", error);-->
<!--                    } else {-->
<!--                        console.error('ê²€ìƒ‰ ìš”ì²­ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ:', error);-->
<!--                        alert('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');-->
<!--                    }-->
<!--                }-->
<!--            });-->

<!--            // [ì„ íƒ] í˜ì´ì§€ ë°”ê¹¥ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°-->
<!--            document.addEventListener('click', (e) => {-->
<!--                if (!categoryBtn.contains(e.target) && !categoryDropdown.contains(e.target)) {-->
<!--                    categoryDropdown.style.display = 'none';-->
<!--                }-->
<!--            });-->
<!--        });-->
<!--    </script>-->


<!--    <script>-->
<!--        // 1. ê¸°ì¡´ì˜ window.fetch í•¨ìˆ˜ë¥¼ ë°±ì—…í•´ë‘¡ë‹ˆë‹¤.-->
<!--        const originalFetch = window.fetch;-->

<!--        // ê°•ì œ ë¡œê·¸ì•„ì›ƒ í—¬í¼ í•¨ìˆ˜-->
<!--        function forceLogout(message) {-->
<!--            localStorage.removeItem('accessToken');-->
<!--            localStorage.removeItem('redirectUrl');-->
<!--            alert(message || 'ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.');-->
<!--            window.location.href = '/auth/login';-->
<!--        }-->

<!--        // 'ìë°œì /ê°•ì œ' ë¡œê·¸ì¸ì„ ìœ„í•œ í—¬í¼ í•¨ìˆ˜-->
<!--        function redirectToLogin() {-->
<!--            if (window.location.pathname !== '/auth/login') {-->
<!--                const fullRedirectUrl = window.location.pathname + window.location.search;-->
<!--                console.log('401 ê°ì§€! ë¦¬ë””ë ‰ì…˜ URL ì €ì¥:', fullRedirectUrl);-->
<!--                localStorage.setItem('redirectUrl', fullRedirectUrl);-->
<!--            }-->
<!--            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');-->
<!--            window.location.href = '/auth/login';-->
<!--        }-->

<!--        /**-->
<!--         * ìë™ í† í° ê°±ì‹ (Silent Refresh) í—¬í¼ í•¨ìˆ˜-->
<!--         * (HttpOnly ì¿ í‚¤ ë°©ì‹)-->
<!--         */-->
<!--        async function handleTokenRefresh() {-->
<!--            const accessToken = localStorage.getItem('accessToken');-->

<!--            if (!accessToken) {-->
<!--                console.log('Access Tokenì´ ì—†ì–´ ê°±ì‹  ë¶ˆê°€.');-->
<!--                return false;-->
<!--            }-->

<!--            try {-->
<!--                // /auth/refresh ìš”ì²­-->
<!--                const refreshResponse = await originalFetch('/auth/refresh', {-->
<!--                    method: 'POST',-->
<!--                    headers: {-->
<!--                        'Authorization': `Bearer ${accessToken}` // ë§Œë£Œëœ AT-->
<!--                    },-->
<!--                    // â˜…â˜…â˜… [ìˆ˜ì • 1] credentials ì¶”ê°€ (ë²„ê·¸ ìˆ˜ì •) â˜…â˜…â˜…-->
<!--                    credentials: 'include'-->
<!--                });-->

<!--                if (refreshResponse.ok) {-->
<!--                    const result = await refreshResponse.json();-->
<!--                    const newAccessToken = result.data.accessToken;-->
<!--                    localStorage.setItem('accessToken', newAccessToken);-->

<!--                    console.log('í† í° ê°±ì‹  ì„±ê³µ (ìƒˆ AT ë°œê¸‰)');-->
<!--                    return true; // ê°±ì‹  ì„±ê³µ-->
<!--                } else {-->
<!--                    const errorBody = await refreshResponse.json();-->
<!--                    console.error('Refresh Token ê°±ì‹  ì‹¤íŒ¨ (ì¿ í‚¤ ë§Œë£Œ ë˜ëŠ” ë¬´íš¨):', errorBody.message);-->
<!--                    return false; // ê°±ì‹  ì‹¤íŒ¨-->
<!--                }-->

<!--            } catch (error) {-->
<!--                console.error('í† í° ê°±ì‹  ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);-->
<!--                return false; // ê°±ì‹  ì‹¤íŒ¨-->
<!--            }-->
<!--        }-->


<!--        // 2. window.fetch í•¨ìˆ˜ ë®ì–´ì“°ê¸°-->
<!--        window.fetch = async (...args) => {-->

<!--            let options = args[1] || {};-->
<!--            const url = args[0];-->

<!--            // ëª¨ë“  fetch ìš”ì²­ì— credentials: 'include'ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •-->
<!--            options.credentials = options.credentials || 'include';-->

<!--            // 3. [ì—­í•  1] í† í° ìë™ ì£¼ì…-->
<!--            if (url !== '/auth/login' && url !== '/auth/signup' && !url.startsWith('/auth/refresh')) {-->
<!--                const accessToken = localStorage.getItem('accessToken');-->
<!--                if (accessToken) {-->
<!--                    options.headers = options.headers || {};-->
<!--                    options.headers['Authorization'] = `Bearer ${accessToken}`;-->
<!--                }-->
<!--            }-->

<!--            // 4. ì›ë³¸ fetch í•¨ìˆ˜ë¡œ ì‹¤ì œ ìš”ì²­ì„ ë³´ëƒ„-->
<!--            const response = await originalFetch(url, options);-->

<!--            // 5. [ì—­í•  2] 401 ì—ëŸ¬ ê°ì§€-->
<!--            if (response.status === 401) {-->

<!--                if (url.startsWith('/auth/refresh')) {-->
<!--                    console.warn('/auth/refresh ìš”ì²­ ì‹¤íŒ¨ (RT ì¿ í‚¤ ë§Œë£Œ). ê°•ì œ ë¡œê·¸ì•„ì›ƒ.');-->
<!--                    forceLogout('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.');-->
<!--                    return new Promise(() => {-->
<!--                    });-->
<!--                }-->

<!--                const clonedResponse = response.clone();-->

<!--                try {-->
<!--                    const errorBody = await clonedResponse.json();-->

<!--                    if (errorBody.message === "ë§Œë£Œëœ JWT í† í°ì…ë‹ˆë‹¤.") {-->
<!--                        console.log("Access Token ë§Œë£Œ. ìë™ ê°±ì‹  ì‹œë„...");-->

<!--                        const refreshSuccess = await handleTokenRefresh();-->

<!--                        if (refreshSuccess) {-->

<!--                            // â˜…â˜…â˜… [ìˆ˜ì • 2] FormData(Stream)ì¸ì§€ í™•ì¸ â˜…â˜…â˜…-->
<!--                            const isStream = options.body && (options.body instanceof FormData || options.body instanceof ReadableStream);-->

<!--                            if (isStream) {-->
<!--                                // FormData/Streamì€ ë˜í¼ê°€ ì¬ì‹œë„(X), ì»¤ìŠ¤í…€ ì—ëŸ¬ ë°œìƒ(O)-->
<!--                                console.log("í† í° ê°±ì‹  ì„±ê³µ. [Stream Body] ì¬ì‹œë„ëŠ” í˜¸ì¶œìê°€ ì§ì ‘ í•´ì•¼ í•¨.");-->
<!--                                const error = new Error("TOKEN_REFRESHED_RETRY_MANUALLY");-->
<!--                                error.name = "TokenRefreshedError";-->
<!--                                throw error; // ai-image.htmlì˜ catchë¬¸ìœ¼ë¡œ ì „ë‹¬-->
<!--                            } else {-->
<!--                                // GET ìš”ì²­ì´ë‚˜ JSON BodyëŠ” ë˜í¼ê°€ ì§ì ‘ ì¬ì‹œë„(O)-->
<!--                                console.log("í† í° ê°±ì‹  ì„±ê³µ. ì›ë˜ ìš”ì²­(GET ë“±) ì¬ì‹œë„.");-->
<!--                                options.headers['Authorization'] = `Bearer ${localStorage.getItem('accessToken')}`;-->
<!--                                return await originalFetch(url, options); // â˜… ìë™ ì¬ì‹œë„-->
<!--                            }-->

<!--                        } else {-->
<!--                            forceLogout('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.');-->
<!--                            return new Promise(() => {-->
<!--                            });-->
<!--                        }-->
<!--                    } else {-->
<!--                        console.warn(`ê¸°íƒ€ 401 ì—ëŸ¬ (${errorBody.message}). ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ.`);-->
<!--                        redirectToLogin();-->
<!--                        return new Promise(() => {-->
<!--                        });-->
<!--                    }-->

<!--                } catch (e) {-->
<!--                    // [ìˆ˜ì •] TokenRefreshedErrorëŠ” ë‹¤ì‹œ ë˜ì ¸ì„œ ai-image.htmlë¡œ ë³´ëƒ„-->
<!--                    if (e.name === "TokenRefreshedError") {-->
<!--                        throw e;-->
<!--                    }-->

<!--                    console.error("401 ì‘ë‹µì´ ì˜ˆìƒëœ JSON í˜•ì‹ì´ ì•„ë‹˜.", e);-->
<!--                    redirectToLogin();-->
<!--                    return new Promise(() => {-->
<!--                    });-->
<!--                }-->
<!--            }-->

<!--            // 10. 401ì´ ì•„ë‹ˆë©´, ì›ë˜ ì‘ë‹µì„ ê·¸ëŒ€ë¡œ ë°˜í™˜-->
<!--            return response;-->
<!--        };-->
<!--    </script>-->


<!--    <script>-->
<!--        const logoutButton = document.getElementById('logout-btn');-->
<!--        if (logoutButton) {-->
<!--            logoutButton.addEventListener('click', async () => {-->

<!--                // "ì •ë§ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" í™•ì¸ì°½-->
<!--                if (window.confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {-->

<!--                    const accessToken = localStorage.getItem('accessToken');-->
<!--                    if (!accessToken) {-->
<!--                        alert('ì´ë¯¸ ë¡œê·¸ì•„ì›ƒ ìƒíƒœì…ë‹ˆë‹¤.');-->
<!--                        return;-->
<!--                    }-->
<!--                    try {-->
<!--                        // ì„œë²„ëŠ” ì´ ìš”ì²­ì„ ë°›ê³  RT ì¿ í‚¤ë¥¼ ì‚­ì œí•˜ëŠ” ì‘ë‹µì„ ë³´ëƒ„-->
<!--                        const response = await originalFetch('/auth/logout', {-->
<!--                            method: 'POST',-->
<!--                            headers: {-->
<!--                                'Authorization': `Bearer ${accessToken}`-->
<!--                            },-->

<!--                            credentials: 'include'-->
<!--                        });-->
<!--                        if (response.ok) {-->
<!--                            console.log('ì„œë²„ Refresh Token ì‚­ì œ ì™„ë£Œ (ì¿ í‚¤ í¬í•¨)');-->
<!--                        } else {-->
<!--                            console.error('ì„œë²„ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì‹¤íŒ¨');-->
<!--                        }-->
<!--                    } catch (error) {-->
<!--                        console.error('ì„œë²„ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);-->
<!--                    } finally {-->
<!--                        localStorage.removeItem('accessToken');-->
<!--                        localStorage.removeItem('redirectUrl');-->
<!--                        alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');-->
<!--                        window.location.href = '/';-->
<!--                    }-->

<!--                } // if (window.confirm...) ë‹«ëŠ” ê´„í˜¸-->
<!--            });-->
<!--        }-->
<!--    </script>-->


<!--    <script>-->
<!--        // (ì‚¬ìš©ì ì›ë³¸ ìŠ¤í¬ë¦½íŠ¸ 4 - JWT íŒŒì‹± ë° UI ì œì–´ - ìˆ˜ì • X)-->

<!--        /**-->
<!--         * [ â˜…â˜…â˜… ì‹ ê·œ í—¬í¼ í•¨ìˆ˜ â˜…â˜…â˜… ]-->
<!--         * Access Token(JWT)ì˜ í˜ì´ë¡œë“œë¥¼ ë””ì½”ë”©í•˜ì—¬ JSON ê°ì²´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.-->
<!--         * (ì„œë²„ì˜ TokenProvider.parseClaimsì™€ ë™ì¼í•œ ì—­í• )-->
<!--         */-->
<!--        function parseJwtPayload(token) {-->
<!--            try {-->
<!--                const base64Url = token.split('.')[1]; // í˜ì´ë¡œë“œ ë¶€ë¶„-->
<!--                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/'); // Base64Url -> Base64-->

<!--                // Base64 ë””ì½”ë”© (UTF-8 ë¬¸ìì—´ì„ ì•ˆì „í•˜ê²Œ ë””ì½”ë”©)-->
<!--                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {-->
<!--                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);-->
<!--                }).join(''));-->

<!--                return JSON.parse(jsonPayload);-->
<!--            } catch (e) {-->
<!--                console.error("JWT í˜ì´ë¡œë“œ ë””ì½”ë”© ì‹¤íŒ¨", e);-->
<!--                return null;-->
<!--            }-->
<!--        }-->


<!--        // DOMì´ ëª¨ë‘ ë¡œë“œëœ í›„ì— ì‹¤í–‰-->
<!--        document.addEventListener('DOMContentLoaded', () => {-->

<!--            // -&#45;&#45; [ìŠ¤í¬ë¦½íŠ¸ 4] UI ì œì–´ ë¡œì§ (â˜…ì´ë©”ì¼ í‘œì‹œ ê¸°ëŠ¥ ì¶”ê°€â˜…) -&#45;&#45;-->
<!--            const accessToken = localStorage.getItem('accessToken');-->
<!--            const loginLink = document.getElementById('global-login-link');-->
<!--            const logoutButton = document.getElementById('logout-btn');-->
<!--            const emailDisplay = document.getElementById('user-email-display');-->

<!--            // â˜…â˜…â˜… [ì‹ ê·œ] 1. ê´€ë¦¬ì ë§í¬ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. â˜…â˜…â˜…-->
<!--            const adminLink = document.getElementById('admin-page-link');-->

<!--            if (loginLink && logoutButton && emailDisplay) { // adminLinkëŠ” nullì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œ ì²´í¬ ì•ˆ í•¨-->
<!--                if (accessToken) {-->
<!--                    // === ë¡œê·¸ì¸í•œ ìƒíƒœ ===-->
<!--                    loginLink.style.display = 'none';-->
<!--                    logoutButton.style.display = 'inline-block';-->

<!--                    // 1. ATë¥¼ ë””ì½”ë”©í•´ì„œ í˜ì´ë¡œë“œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.-->
<!--                    const payload = parseJwtPayload(accessToken);-->

<!--                    if (payload) {-->
<!--                        // 2. 'sub' í´ë ˆì„(ì´ë©”ì¼)ì„ <span>ì— í‘œì‹œí•©ë‹ˆë‹¤.-->
<!--                        emailDisplay.textContent = payload.sub + " ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!";-->
<!--                        emailDisplay.style.display = 'inline-block';-->

<!--                        // â˜…â˜…â˜… [ì‹ ê·œ] 3. ì—­í• (Role) í™•ì¸ ë¡œì§ â˜…â˜…â˜…-->
<!--                        // â€»ì°¸ê³ : JWTì˜ ì—­í•  í´ë ˆì„ ì´ë¦„ì„ 'auth'ë¡œ ê°€ì •í•©ë‹ˆë‹¤.-->
<!--                        //       (ì„œë²„ì—ì„œ 'role', 'roles' ë“±ìœ¼ë¡œ ì„¤ì •í–ˆë‹¤ë©´ ê·¸ê±¸ë¡œ ë°”ê¿”ì£¼ì„¸ìš”)-->
<!--                        //       (ì˜ˆ: 'ROLE_ADMIN', 'ADMIN' ë“± ì„œë²„ì—ì„œ ë³´ë‚¸ ê°’ ê·¸ëŒ€ë¡œ ë¹„êµ)-->
<!--                        if (adminLink && payload.auth === 'ROLE_ADMIN') {-->
<!--                            adminLink.style.display = 'inline-block'; // ê´€ë¦¬ìì¼ ê²½ìš° ë§í¬ í‘œì‹œ-->
<!--                        }-->
<!--                    }-->

<!--                } else {-->
<!--                    // === ë¡œê·¸ì•„ì›ƒí•œ ìƒíƒœ ===-->
<!--                    loginLink.style.display = 'inline-block';-->
<!--                    logoutButton.style.display = 'none';-->
<!--                    emailDisplay.style.display = 'none';-->

<!--                    // â˜…â˜…â˜… [ì‹ ê·œ] 4. ë¡œê·¸ì•„ì›ƒ ìƒíƒœë©´ ê´€ë¦¬ì ë§í¬ë„ ìˆ¨ê¹€ â˜…â˜…â˜…-->
<!--                    if (adminLink) {-->
<!--                        adminLink.style.display = 'none';-->
<!--                    }-->
<!--                }-->
<!--            }-->

<!--            // -&#45;&#45; [ìŠ¤í¬ë¦½íŠ¸ 3] ìë°œì  ë¡œê·¸ì¸ ë§í¬ í´ë¦­ ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼) -&#45;&#45;-->
<!--            if (loginLink) {-->
<!--                loginLink.addEventListener('click', (e) => {-->
<!--                    e.preventDefault();-->
<!--                    const currentUrl = window.location.pathname + window.location.search;-->
<!--                    if (window.location.pathname !== '/auth/login') {-->
<!--                        console.log('ë¡œê·¸ì¸ ë§í¬ í´ë¦­! ë¦¬ë””ë ‰ì…˜ URL ì €ì¥:', currentUrl);-->
<!--                        localStorage.setItem('redirectUrl', currentUrl);-->
<!--                    }-->
<!--                    window.location.href = loginLink.href;-->
<!--                });-->
<!--            }-->
<!--        });-->
<!--    </script>-->

<!--</div>-->