<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>로그인 처리 중...</title>
</head>
<body>
<p>로그인 처리 중입니다. 잠시만 기다려주세요...</p>

<script>
    // 페이지가 로드되자마자 즉시 실행
    document.addEventListener('DOMContentLoaded', () => {
        try {
            // 1. 현재 URL의 쿼리 파라미터( ?token=... )를 읽습니다.
            const urlParams = new URLSearchParams(window.location.search);
            const accessToken = urlParams.get('token');

            if (accessToken) {
                // 2. [성공] Access Token을 localStorage에 저장합니다.
                //    (Refresh Token은 이미 HttpOnly 쿠키에 저장되어 있습니다.)
                localStorage.setItem('accessToken', accessToken);
                console.log('OAuth 로그인 성공. Access Token 저장 완료.');

                // 3. (중요) 기존 "이전 페이지" 리디렉션 로직을 재사용합니다.
                //    '자발적 로그인'을 시도했다면 redirectUrl이 저장되어 있을 겁니다.
                const redirectUrl = localStorage.getItem('redirectUrl');

                if (redirectUrl) {
                    localStorage.removeItem('redirectUrl');
                    window.location.href = redirectUrl; // 원래 가려던 페이지로 이동
                } else {
                    window.location.href = '/'; // 메인 페이지로 이동
                }

            } else {
                // 4. [실패] 토큰이 없이 콜백 됨
                alert('OAuth 로그인에 실패했습니다. (토큰 없음)');
                window.location.href = '/auth/login'; // 로그인 페이지로 복귀
            }
        } catch (error) {
            console.error('OAuth 콜백 처리 중 오류:', error);
            alert('로그인 처리 중 오류가 발생했습니다.');
            window.location.href = '/auth/login';
        }
    });
</script>
</body>
</html>