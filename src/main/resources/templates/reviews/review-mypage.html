<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆì´í˜ì´ì§€ - ë‚´ê°€ ì“´ ë¦¬ë·°</title>
    <link rel="stylesheet" th:href="@{/css/styles1.css}">
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
            background-color: #f5f5f5;
        }

        .mypage-wrapper {
            max-width: 1100px;
            margin: 40px auto;
            padding: 24px;
            background-color: #ffffff;
            border-radius: 16px;
            border: 2px solid #FEE500; /* ì¹´ì¹´ì˜¤í†¡ ë…¸ë‘ í…Œë‘ë¦¬ */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            display: flex;
            gap: 24px;
        }

        /* ì™¼ìª½ ë©”ë‰´ ì˜ì—­ */
        .mypage-menu {
            flex: 0 0 220px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .mypage-menu-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #3C1E1E; /* ì¹´ì¹´ì˜¤í†¡ ë‹¤í¬ ë¸Œë¼ìš´ ëŠë‚Œ */
        }

        .mypage-menu-item {
            display: block;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid #FEE500;
            background-color: #fffdf0;
            text-decoration: none;
            color: #3C1E1E;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.15s ease-in-out;
        }

        .mypage-menu-item:hover {
            background-color: #FEE500;
            transform: translateY(-1px);
        }

        .mypage-menu-item.active {
            background-color: #FEE500;
            box-shadow: 0 4px 12px rgba(254, 229, 0, 0.4);
        }

        /* ì˜¤ë¥¸ìª½ ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
        .mypage-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .mypage-content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mypage-content-title {
            font-size: 22px;
            font-weight: 700;
            color: #222;
        }

        .mypage-content-sub {
            font-size: 13px;
            color: #888;
        }

        .review-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 8px;
        }

        .review-card {
            display: flex;
            gap: 12px;
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid #eee;
            background-color: #ffffff;
            transition: box-shadow 0.15s ease-in-out, transform 0.1s ease-in-out;
        }

        .review-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            transform: translateY(-1px);
        }

        .review-thumbnail {
            flex: 0 0 90px;
            height: 90px;
            border-radius: 10px;
            background-color: #f3f3f3;
            overflow: hidden;
        }

        .review-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .review-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .review-place {
            font-size: 13px;
            font-weight: 600;
            color: #a67c00;
        }

        .review-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .review-content {
            font-size: 13px;
            color: #666;
            max-height: 40px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .review-meta {
            margin-top: 4px;
            font-size: 12px;
            color: #999;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .badge-rate {
            display: inline-flex;
            align-items: center;
            padding: 2px 6px;
            border-radius: 999px;
            background-color: #fff7b8;
            font-size: 12px;
            font-weight: 600;
            color: #3C1E1E;
        }

        .empty-message {
            padding: 24px;
            text-align: center;
            font-size: 14px;
            color: #777;
            border-radius: 12px;
            background-color: #fafafa;
            border: 1px dashed #ddd;
            margin-top: 16px;
        }
    </style>
</head>
<body>
<div th:replace="~{common/header :: header}"></div>

<div class="mypage-wrapper">

    <!-- ì™¼ìª½ ë©”ë‰´ -->
    <aside class="mypage-menu">
        <div class="mypage-menu-title">ë§ˆì´í˜ì´ì§€</div>

        <a th:href="@{/mypage/profile}" class="mypage-menu-item">
            íšŒì›ì •ë³´ ìˆ˜ì •
        </a>

        <a th:href="@{/reviews/mypage}" class="mypage-menu-item active">
            ë‚´ ë¦¬ë·° ë³´ê¸°
        </a>

        <a th:href="@{/mypage/favorites}" class="mypage-menu-item">
            ë‚´ ì¦ê²¨ì°¾ê¸° ë³´ê¸°
        </a>
    </aside>

    <!-- ì˜¤ë¥¸ìª½ ë‚´ìš© -->
    <section class="mypage-content">
        <div class="mypage-content-header">
            <div class="mypage-content-title">ë‚´ê°€ ì“´ ë¦¬ë·°</div>
            <div class="mypage-content-sub" id="review-count-text">
                ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦
            </div>
        </div>

        <div id="review-list" class="review-list">
            <!-- JSë¡œ ì¹´ë“œê°€ ì±„ì›Œì§ -->
        </div>

        <div id="empty-message" class="empty-message" style="display: none;">
            ì•„ì§ ì‘ì„±í•œ ë¦¬ë·°ê°€ ì—†ì–´ìš”.<br>
            ì—¬í–‰ ëŒ€ë¦¬ë§Œì¡± ì‚¬ì§„ì„ ë§Œë“¤ê³  ì²« ë¦¬ë·°ë¥¼ ë‚¨ê²¨ë³¼ê¹Œìš”? ğŸ˜Š
        </div>
    </section>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        loadMyReviews();
    });

    function loadMyReviews() {
        // í† í°ì„ í—¤ë”ì— ë„£ì–´ì•¼ í•œë‹¤ë©´ ì—¬ê¸°ì„œ localStorageì—ì„œ êº¼ë‚´ì„œ ë¶™ì´ë©´ ë¨
        // const accessToken = localStorage.getItem("accessToken");

        fetch("/api/v1/reviews/my", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                // "Authorization": "Bearer " + accessToken
            }
        })
            .then(res => {
                if (!res.ok) {
                    throw new Error("ë¦¬ë·° ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨");
                }
                return res.json();
            })
            .then(data => {
                renderReviewList(data);
            })
            .catch(err => {
                console.error(err);
                document.getElementById("review-count-text").textContent = "ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
            });
    }

    function renderReviewList(reviews) {
        const listEl = document.getElementById("review-list");
        const emptyEl = document.getElementById("empty-message");
        const countText = document.getElementById("review-count-text");

        listEl.innerHTML = "";

        if (!reviews || reviews.length === 0) {
            emptyEl.style.display = "block";
            countText.textContent = "ì‘ì„±í•œ ë¦¬ë·° 0ê°œ";
            return;
        }

        emptyEl.style.display = "none";
        countText.textContent = `ì‘ì„±í•œ ë¦¬ë·° ${reviews.length}ê°œ`;

        reviews.forEach(review => {
            const card = document.createElement("div");
            card.className = "review-card";

            const thumb = document.createElement("div");
            thumb.className = "review-thumbnail";

            if (review.imgUrl) {
                const img = document.createElement("img");
                // í”„ë¡œì íŠ¸ ì´ë¯¸ì§€ ê²½ë¡œ ê·œì¹™ì— ë§ê²Œ ìˆ˜ì •
                img.src = `/images/review/${review.imgUrl}`;
                img.alt = review.title || "ë¦¬ë·° ì´ë¯¸ì§€";
                thumb.appendChild(img);
            }

            const info = document.createElement("div");
            info.className = "review-info";

            const place = document.createElement("div");
            place.className = "review-place";
            place.textContent = review.placeName || "ì—¬í–‰ì§€ ì •ë³´ ì—†ìŒ";

            const title = document.createElement("div");
            title.className = "review-title";
            title.textContent = review.title;

            const content = document.createElement("div");
            content.className = "review-content";
            content.textContent = review.content;

            const meta = document.createElement("div");
            meta.className = "review-meta";

            const rateBadge = document.createElement("span");
            rateBadge.className = "badge-rate";
            rateBadge.textContent = `â˜… ${review.rate || 0} / 5`;

            const created = document.createElement("span");
            created.textContent = (review.createdAt || "").replace("T", " ");

            meta.appendChild(rateBadge);
            meta.appendChild(created);

            info.appendChild(place);
            info.appendChild(title);
            info.appendChild(content);
            info.appendChild(meta);

            card.appendChild(thumb);
            card.appendChild(info);

            listEl.appendChild(card);
        });
    }
</script>

</body>
</html>
